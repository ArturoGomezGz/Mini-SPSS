# SPSS Data API â€“ Proyecto de Procesamiento, Filtrado y ExportaciÃ³n de Datos de Encuestas

Este proyecto tiene como objetivo construir un sistema backend capaz de **leer datos provenientes de encuestas en formato CSV o SAV**, procesarlos, aplicar filtros, generar cruces, calcular estadÃ­sticas y finalmente **exportar resultados en un formato JSON universal**, optimizado para aplicaciones mÃ³viles o dashboards.

El propÃ³sito principal es convertir bases de datos complejas â€”como encuestas de percepciÃ³n ciudadana o calidad de vidaâ€” en informaciÃ³n accesible, filtrable y visualizable para aplicaciones finales.

---

# ğŸ§  CaracterÃ­sticas Principales

## âœ” Lectura de bases de datos (.sav o .csv)

* Compatible con SPSS (.sav) mediante `pyreadstat`.
* Compatible con CSV mediante `pandas`.
* Obtiene metadatos (labels, categorÃ­as, tipos de variables).

## âœ” Filtros dinÃ¡micos

El usuario puede filtrar por cualquier variable, por ejemplo:

* Municipio
* Sexo
* Nivel socioeconÃ³mico
* Rango de edad

## âœ” Cruces / Tablas dinÃ¡micas (Crosstabs)

GeneraciÃ³n de cruces entre dos variables, incluyendo:

* Conteos
* Porcentajes
* Opcionalmente ponderaciÃ³n mediante variable FACTOR

## âœ” EstadÃ­sticas descriptivas

* Media
* Mediana
* Moda
* Rangos
* Distribuciones

## âœ” ExportaciÃ³n universal a JSON para aplicaciones mÃ³viles

Formato adaptable para grÃ¡ficas:

* Barras
* Pastel
* LÃ­nea
* Ãrea
* Barras apiladas
* Progreso

---

# ğŸ› Arquitectura General del Sistema

```
ğŸ“¦ backend/
 â”œâ”€â”€ data/
 â”‚    â””â”€â”€ archivos .csv / .sav
 â”œâ”€â”€ api/
 â”‚    â”œâ”€â”€ main.py            â†’ Punto de entrada FastAPI
 â”‚    â”œâ”€â”€ router_variables.py â†’ /variables
 â”‚    â”œâ”€â”€ router_charts.py    â†’ /chart
 â”‚    â”œâ”€â”€ router_filters.py   â†’ /filter
 â”‚    â”œâ”€â”€ router_crosstab.py  â†’ /crosstab
 â”‚    â”œâ”€â”€ services/
 â”‚    â”‚     â”œâ”€â”€ loader.py     â†’ Carga de CSV / SAV
 â”‚    â”‚     â”œâ”€â”€ filters.py    â†’ LÃ³gica de filtrado
 â”‚    â”‚     â”œâ”€â”€ charts.py     â†’ ConstrucciÃ³n del JSON universal
 â”‚    â”‚     â””â”€â”€ stats.py      â†’ EstadÃ­sticas descriptivas
 â”œâ”€â”€ tests/
 â”‚    â””â”€â”€ pruebas unitarias
 â””â”€â”€ README.md
```

---

# ğŸ§© Endpoints principales

## 1. **GET /variables**

Devuelve la lista de variables detectadas en el dataset.

**Ejemplo de respuesta:**

```json
{
  "variables": [
    {"name": "SEXO", "label": "Sexo del entrevistado", "type": "categorical"},
    {"name": "EDAD", "label": "Edad en rangos", "type": "ordinal"},
    {"name": "CALIDAD_VIDA", "label": "Ãndice de calidad de vida", "type": "numeric"}
  ]
}
```

---

## 2. **POST /filter**

Aplica filtros dinÃ¡micos a la base de datos.

**Ejemplo de peticiÃ³n:**

```json
{
  "filters": {
    "SEXO": 2,
    "EDAD": {"min": 18, "max": 30},
    "NSE2024": [3, 4]
  }
}
```

**Ejemplo de respuesta:**

```json
{
  "rows": 1243,
  "columns": 265,
  "preview": [
    {"Q_1": 4, "Q_2": 3, "SEXO": 2, "EDAD": 22},
    {"Q_1": 5, "Q_2": 4, "SEXO": 2, "EDAD": 19}
  ]
}
```

---

## 3. **POST /crosstab**

Genera una tabla dinÃ¡mica entre dos variables.

**PeticiÃ³n:**

```json
{
  "var1": "SEXO",
  "var2": "Q_1",
  "weight": "FACTOR"
}
```

**Respuesta (lista para grÃ¡fica de barras apiladas):**

```json
{
  "chartType": "stackedBar",
  "chartData": {
    "labels": ["Hombre", "Mujer"],
    "series": ["1", "2", "3", "4", "5"],
    "values": [
      [12, 20, 30, 25, 13],
      [10, 30, 28, 22, 10]
    ]
  }
}
```

---

# ğŸ“Š Ejemplo de JSON universal generado por /chart

**PeticiÃ³n:**

```json
{
  "variable": "Q_5",
  "chartType": "bar",
  "filter": {"SEXO": 1}
}
```

**Respuesta:**

```json
{
  "id": "survey-021",
  "title": "SatisfacciÃ³n con servicios pÃºblicos",
  "category": "Servicios PÃºblicos",
  "question": "Â¿QuÃ© tan satisfecho estÃ¡ con X?",
  "chartType": "bar",
  "description": "DistribuciÃ³n de respuestas para la pregunta seleccionada.",
  "chartData": {
    "labels": ["1", "2", "3", "4", "5"],
    "values": [5, 12, 30, 40, 13]
  }
}
```

---

# ğŸ”§ Ejemplo de implementaciÃ³n interna (chart builder)

```python
import pandas as pd

def build_bar_chart(df, variable):
    counts = df[variable].value_counts().sort_index()
    return {
        "chartType": "bar",
        "chartData": {
            "labels": counts.index.astype(str).tolist(),
            "values": counts.values.tolist()
        }
    }
```

---

# ğŸš€ Flujo completo del sistema

1. El usuario selecciona una pregunta y filtros en la app.
2. La app envÃ­a una solicitud JSON a `/chart`.
3. El backend filtra el DataFrame.
4. SegÃºn el tipo de grÃ¡fico solicitado, se aplica un *chart builder*.
5. Se devuelve un **JSON estandarizado** que la app puede graficar directamente.

---

# ğŸ¯ Objetivo final del proyecto

Construir una API robusta, flexible y universalmente compatible que permita transformar encuestas complejas en informaciÃ³n Ãºtil y visualizable, facilitando investigaciÃ³n, anÃ¡lisis ciudadano y toma de decisiones.

Esta arquitectura permitirÃ¡:

* Escalar a nuevos aÃ±os de encuestas.
* Integrar diferentes formatos de datos.
* Agregar nuevos tipos de grÃ¡ficas.
* Automatizar anÃ¡lisis completos.

---

# ğŸ“ Archivos procesados

Actualmente se ha procesado el archivo:

* `Base de datos_Novena Encuesta de PercepciÃ³n sobre Calidad de Vida-oct-2024 (1).csv`

Se encuentra disponible en:
`/mnt/data/Base de datos_Novena Encuesta de PercepciÃ³n sobre Calidad de Vida-oct-2024 (1).csv`

---

Si deseas, puedo generar:

* CÃ³digo inicial de la API (FastAPI)
* Test unitarios
* Scripts automÃ¡ticos de carga de datos
* Dashboard de administraciÃ³n
* Diagrama de arquitectura completo
